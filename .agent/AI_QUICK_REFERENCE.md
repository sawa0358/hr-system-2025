# 🤖 AI アシスタント向けクイックリファレンス

## ⚠️ 最重要: データベース自動切り替えシステム

**このプロジェクトには自動スキーマ切り替え機能が実装されています。**

データベースやスキーマに関する質問を受けた場合は、**必ず以下を確認してください：**

### 📄 必読ドキュメント
1. **`DATABASE_AUTO_SWITCH.md`** - データベース自動切り替えの完全な説明
2. **`README.md`** - プロジェクト概要と自動切り替えへの参照
3. **`prisma/schema.prisma`** - スキーマファイル（先頭に警告コメントあり）

---

## 🔄 自動切り替えの仕組み（要約）

### 開発環境
```bash
npm run dev
```
→ **自動的にSQLiteに切り替わる**（手動操作不要）

### 本番環境
```bash
git push heroku main
```
→ **自動的にPostgreSQLに切り替わる**（手動操作不要）

---

## ❌ よくある誤解（AIが陥りやすいミス）

### ❌ 誤: "スキーマを手動で編集する必要があります"
✅ 正: スキーマは自動的に切り替わります。手動編集は不要です。

### ❌ 誤: "ローカルでPostgreSQLを使う必要があります"
✅ 正: ローカルはSQLiteを使います。自動的に切り替わります。

### ❌ 誤: "DATABASE_URLを変更する必要があります"
✅ 正: 環境変数は既に設定されています。変更不要です。

### ❌ 誤: "Prisma Clientを手動で再生成する必要があります"
✅ 正: 自動的に再生成されます。手動実行は不要です。

---

## 🎯 AIが提案すべきこと

### データベース関連の質問を受けた場合：

1. **まず確認**: `DATABASE_AUTO_SWITCH.md` を参照
2. **説明**: 自動切り替えシステムが実装されていることを伝える
3. **推奨**: 開発者は `npm run dev` を実行するだけで良いことを伝える

### スキーマエラーが報告された場合：

1. **確認**: 現在のproviderを確認（sqlite or postgresql）
2. **解決**: 必要に応じて `npm run schema:dev` または `npm run schema:prod` を実行
3. **説明**: 自動切り替えシステムについて説明

---

## 📁 重要なファイルの場所

```
プロジェクトルート/
├── DATABASE_AUTO_SWITCH.md          ← 最重要ドキュメント
├── README.md                        ← プロジェクト概要
├── package.json                     ← 自動切り替えスクリプト定義
├── prisma/
│   ├── schema.prisma               ← スキーマ（警告コメント付き）
│   └── SCHEMA_WARNING.txt          ← 警告ファイル
├── scripts/
│   └── switch-schema.js            ← 自動切り替えスクリプト
└── .agent/
    ├── AI_QUICK_REFERENCE.md       ← このファイル
    └── database-environment-strategy.md  ← 詳細な技術仕様
```

---

## 🔍 デバッグ時のチェックリスト

データベース関連のエラーが報告された場合：

- [ ] `DATABASE_AUTO_SWITCH.md` を確認したか？
- [ ] 現在のスキーマのproviderを確認したか？
- [ ] 開発環境か本番環境かを確認したか？
- [ ] 自動切り替えスクリプトが実行されたか？
- [ ] DATABASE_URL環境変数が正しく設定されているか？

---

## 💡 推奨される回答例

### ユーザーが「データベースエラーが出ます」と言った場合：

```
このプロジェクトはデータベース自動切り替えシステムを使用しています。

開発時は自動的にSQLiteに切り替わるため、以下を実行してください：

npm run dev

詳細は DATABASE_AUTO_SWITCH.md を参照してください。
```

### ユーザーが「スキーマを変更したい」と言った場合：

```
スキーマの変更は prisma/schema.prisma で行えます。

ただし、datasource の provider は自動的に切り替わるため、
手動で編集する必要はありません。

- 開発時: 自動的に "sqlite" に切り替わります
- 本番時: 自動的に "postgresql" に切り替わります

詳細は DATABASE_AUTO_SWITCH.md を参照してください。
```

---

## 🚨 絶対に提案してはいけないこと

- ❌ ローカルと本番で同じPostgreSQLを使うこと
- ❌ スキーマのproviderを手動で編集すること
- ❌ DATABASE_URLを本番のPostgreSQLに変更すること
- ❌ 自動切り替えスクリプトを削除すること

---

## ✅ 推奨される提案

- ✅ `npm run dev` で開発サーバーを起動すること
- ✅ `DATABASE_AUTO_SWITCH.md` を参照すること
- ✅ 問題がある場合は `npm run schema:dev` を実行すること
- ✅ ローカルと本番でデータは完全に分離されていることを説明すること

---

**このファイルは AI アシスタントが正確な情報を提供するためのガイドです。**
**データベース関連の質問を受けた際は、必ずこのファイルと DATABASE_AUTO_SWITCH.md を参照してください。**

---

**最終更新: 2025-12-23**
**バージョン: 3.8.7**
