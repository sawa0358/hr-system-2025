# æ¥­å‹™ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ å®Ÿè£…å¼•ãç¶™ãæ›¸

## ğŸ“‹ æ¦‚è¦

WorkClockï¼ˆæ™‚é–“ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã«æ¥­å‹™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚
ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒæ—¥ã€…ã®æ¥­å‹™é …ç›®ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãƒã‚§ãƒƒã‚¯é …ç›®ã«å¿œã˜ãŸå ±é…¬ãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚

**ãƒ–ãƒ©ãƒ³ãƒ**: `feature/business-checklist-ui`  
**æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `c38e403`

---

## ğŸ¯ å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### 1. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†
- **å ´æ‰€**: `/workclock/admin/checklist-patterns`
- **æ©Ÿèƒ½**:
  - ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
  - å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã«è¤‡æ•°ã®ãƒã‚§ãƒƒã‚¯é …ç›®ã‚’è¨­å®š
  - é …ç›®ã”ã¨ã«å ±é…¬é¡ã€å¿…é ˆ/ä»»æ„ã€ã‚«ãƒ†ã‚´ãƒªã‚’è¨­å®š
  - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§é …ç›®ã®ä¸¦ã³æ›¿ãˆ

### 2. ãƒ¯ãƒ¼ã‚«ãƒ¼ã¸ã®ãƒ‘ã‚¿ãƒ¼ãƒ³å‰²ã‚Šå½“ã¦
- **å ´æ‰€**: ãƒ¯ãƒ¼ã‚«ãƒ¼ç™»éŒ²ãƒ»ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«
- **æ©Ÿèƒ½**:
  - ã€Œæ¥­å‹™ãƒã‚§ãƒƒã‚¯æœ‰åŠ¹åŒ–ã€ãƒˆã‚°ãƒ«
  - ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®é¸æŠ

### 3. æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå…¥åŠ›
- **å ´æ‰€**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œæ¥­å‹™ãƒã‚§ãƒƒã‚¯ã€ã‚¿ãƒ–
- **æ©Ÿèƒ½**:
  - ãƒã‚§ãƒƒã‚¯é …ç›®ã®é¸æŠï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
  - å ±é…¬ã®è‡ªå‹•è¨ˆç®—ãƒ»è¡¨ç¤º
  - ãƒ¡ãƒ¢å…¥åŠ›
  - ä¿å­˜æ©Ÿèƒ½ï¼ˆåŒæ—¥å†ä¿å­˜ã§ä¸Šæ›¸ãï¼‰
  - ä¿å­˜æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒè¡¨ç¤º

### 4. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
- **æ©Ÿèƒ½**:
  - å‹¤å‹™è¨˜éŒ²ã®ã¿: æ°´è‰²èƒŒæ™¯
  - æ¥­å‹™ãƒã‚§ãƒƒã‚¯ã®ã¿: è–„ç·‘è‰²èƒŒæ™¯ + ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³
  - ä¸¡æ–¹ã‚ã‚Š:
    - ãƒ¢ãƒã‚¤ãƒ«: ç·‘ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿
    - å¤§ç”»é¢: å‹¤å‹™æ™‚é–“+å‚™è€ƒ+ã€Œãƒã‚§ãƒƒã‚¯æ¸ˆã€è¡¨ç¤º

### 5. æœˆæ¬¡é›†è¨ˆ
- **å ´æ‰€**: WorkerSummaryï¼ˆä»Šæœˆã®å ±é…¬è¦‹è¾¼ã‚«ãƒ¼ãƒ‰ï¼‰
- **æ©Ÿèƒ½**:
  - æœˆé–“ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå ±é…¬ã‚’è‡ªå‹•é›†è¨ˆ
  - ã€Œ+ æ¥­å‹™ãƒã‚§ãƒƒã‚¯å ±é…¬ Â¥XXXã€ã¨ã—ã¦è¡¨ç¤ºï¼ˆç·‘è‰²ï¼‰

### 6. PDFå‡ºåŠ›
- **æ©Ÿèƒ½**:
  - ã‚µãƒãƒªãƒ¼æ¬„ã«ã€Œæ¥­å‹™ãƒã‚§ãƒƒã‚¯å ±é…¬ã€ã‚’è¿½åŠ 
  - æºæ³‰ãªã—å°è¨ˆã«å«ã¾ã‚Œã‚‹
  - ä¸‹éƒ¨ã®è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å‰Šé™¤æ¸ˆã¿ï¼ˆã‚µãƒãƒªãƒ¼ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼‰

---

## ğŸ—‚ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### WorkClockChecklistPattern
```prisma
model WorkClockChecklistPattern {
  id          String   @id @default(cuid())
  name        String
  description String?
  items       WorkClockChecklistItem[]
  workers     WorkClockWorker[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

### WorkClockChecklistItem
```prisma
model WorkClockChecklistItem {
  id          String   @id @default(cuid())
  patternId   String
  pattern     WorkClockChecklistPattern @relation(...)
  title       String
  reward      Float    @default(0)
  isMandatory Boolean  @default(false)
  category    String?
  position    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

### WorkClockChecklistSubmission
```prisma
model WorkClockChecklistSubmission {
  id            String   @id @default(cuid())
  workerId      String
  worker        WorkClockWorker @relation(...)
  date          DateTime
  memo          String?
  hasPhoto      Boolean  @default(false)
  isSafetyAlert Boolean  @default(false)
  items         WorkClockChecklistSubmissionItem[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
```

### WorkClockChecklistSubmissionItem
```prisma
model WorkClockChecklistSubmissionItem {
  id           String   @id @default(cuid())
  submissionId String
  submission   WorkClockChecklistSubmission @relation(...)
  title        String
  reward       Float    @default(0)
  isMandatory  Boolean  @default(false)
  isChecked    Boolean  @default(false)
  category     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
```

---

## ğŸ“ ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«

### API Routes
- `app/api/workclock/checklist/patterns/route.ts` - ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è¦§ãƒ»ä½œæˆ
- `app/api/workclock/checklist/patterns/[id]/route.ts` - ãƒ‘ã‚¿ãƒ¼ãƒ³å–å¾—ãƒ»æ›´æ–°ãƒ»å‰Šé™¤
- `app/api/workclock/checklist/submissions/route.ts` - æå‡ºä¸€è¦§ãƒ»ä½œæˆï¼ˆä¸Šæ›¸ãä¿å­˜å¯¾å¿œï¼‰

### Components
- `components/workclock/checklist-panel.tsx` - ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå…¥åŠ›UI
- `components/workclock/time-entry-dialog.tsx` - å‹¤å‹™è¨˜éŒ²+ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®ãƒ¢ãƒ¼ãƒ€ãƒ«
- `components/workclock/calendar-view.tsx` - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºï¼ˆãƒã‚§ãƒƒã‚¯æ¸ˆã¿æ—¥ã®è‰²åˆ†ã‘ï¼‰
- `components/workclock/worker-summary.tsx` - æœˆæ¬¡ã‚µãƒãƒªãƒ¼ï¼ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå ±é…¬è¡¨ç¤ºï¼‰
- `app/workclock/admin/checklist-patterns/page.tsx` - ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†ç”»é¢

### Libraries
- `lib/workclock/api.ts` - APIå‘¼ã³å‡ºã—é–¢æ•°
- `lib/workclock/pdf-export.tsx` - PDFç”Ÿæˆï¼ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå ±é…¬å¯¾å¿œï¼‰

---

## ğŸ”§ é‡è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ

### 1. React Stateç®¡ç†ã®æ³¨æ„ç‚¹
**å•é¡Œ**: `onStateChange`ã‚’ç›´æ¥å‘¼ã¶ã¨Reactã®è­¦å‘ŠãŒå‡ºã‚‹
**è§£æ±º**: `setTimeout(() => onStateChange(...), 0)` ã§é…å»¶å®Ÿè¡Œ

```tsx
// checklist-panel.tsx
const handleToggle = (id: string) => {
  setCheckedItems(prev => {
    const newState = { ...prev, [id]: !prev[id] }
    setTimeout(() => {
      onStateChange?.({ checkedItems: newState, memo: reportText, items: checklistItems })
    }, 0)
    return newState
  })
}
```

### 2. é‡è¤‡ä¿å­˜ã®é˜²æ­¢
**å•é¡Œ**: åŒã˜æ—¥ã«ä½•åº¦ã‚‚ä¿å­˜ã™ã‚‹ã¨é‡è¤‡ãƒ‡ãƒ¼ã‚¿ãŒè“„ç©
**è§£æ±º**: ä¿å­˜æ™‚ã«æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰æ–°è¦ä½œæˆ

```typescript
// app/api/workclock/checklist/submissions/route.ts
// åŒã˜æ—¥ã®æ—¢å­˜æå‡ºã‚’æ¤œç´¢
const existingSubmissions = await prisma.workClockChecklistSubmission.findMany({
  where: {
    workerId,
    date: { gte: startOfDay, lt: endOfDay }
  }
})

// æ—¢å­˜ãŒã‚ã‚Œã°å‰Šé™¤
if (existingSubmissions.length > 0) {
  await prisma.workClockChecklistSubmissionItem.deleteMany(...)
  await prisma.workClockChecklistSubmission.deleteMany(...)
}

// æ–°è¦ä½œæˆ
await prisma.workClockChecklistSubmission.create(...)
```

### 3. ä¿å­˜æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒ
**å®Ÿè£…å ´æ‰€**: `checklist-panel.tsx` ã® `useEffect`

```tsx
// æ—¢å­˜ã®æå‡ºãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const submissionRes = await api.checklist.submissions.getAll({
  workerId,
  startDate: dateStr,
  endDate: dateStr,
})

// ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’å¾©å…ƒï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã§ãƒãƒƒãƒãƒ³ã‚°ï¼‰
const checkedMap: Record<string, boolean> = {}
submission.items.forEach((item: any) => {
  const matchingItem = items.find(i => i.title === item.title)
  if (matchingItem && item.isChecked) {
    checkedMap[matchingItem.id] = true
  }
})
setCheckedItems(checkedMap)
```

### 4. æœˆæ¬¡é›†è¨ˆã®è¨ˆç®—
**å®Ÿè£…å ´æ‰€**: `app/workclock/worker/[id]/page.tsx`

```tsx
const submissionRes = await api.checklist.submissions.getAll({
  workerId,
  startDate: firstDay,
  endDate: lastDay,
})

const totalChecklist = submissionRes.submissions.reduce((total, sub) => {
  if (sub.items) {
    return total + sub.items.reduce((itemTotal: number, item: any) => {
      return itemTotal + (item.isChecked ? (item.reward || 0) : 0)
    }, 0)
  }
  return total
}, 0)
setChecklistReward(totalChecklist)
```

---

## ğŸ› æ—¢çŸ¥ã®å•é¡Œãƒ»åˆ¶é™äº‹é …

### 1. ãƒ†ã‚¹ãƒˆä¸­ã®é‡è¤‡ãƒ‡ãƒ¼ã‚¿
- **çŠ¶æ³**: é–‹ç™ºä¸­ã«åŒã˜æ—¥ã«è¤‡æ•°å›ä¿å­˜ã—ãŸãŸã‚é‡è¤‡ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨
- **å¯¾å‡¦**: æ‰‹å‹•ã§SQLã‚¯ã‚¨ãƒªã§å‰Šé™¤æ¸ˆã¿
- **ä»Šå¾Œ**: ä¸Šæ›¸ãä¿å­˜æ©Ÿèƒ½ã«ã‚ˆã‚Šæ–°è¦ç™ºç”Ÿã—ãªã„

### 2. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‰Šé™¤
- **åˆ¶é™**: ãƒ¯ãƒ¼ã‚«ãƒ¼ã«å‰²ã‚Šå½“ã¦æ¸ˆã¿ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å‰Šé™¤ä¸å¯
- **ç†ç”±**: å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„
- **å¯¾å‡¦**: å‰Šé™¤å‰ã«ãƒ¯ãƒ¼ã‚«ãƒ¼ã®å‰²ã‚Šå½“ã¦ã‚’è§£é™¤ã™ã‚‹å¿…è¦ã‚ã‚Š

### 3. PDFå‡ºåŠ›ã®æºæ³‰å¾´å
- **ä»•æ§˜**: ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå ±é…¬ã¯æºæ³‰ãªã—å°è¨ˆã«å«ã¾ã‚Œã‚‹
- **ç†ç”±**: `isWithholding: false` ã§è¨­å®š
- **å¤‰æ›´æ–¹æ³•**: `pdf-export.tsx` ã® `breakdowns.push()` ã§ `isWithholding: true` ã«å¤‰æ›´

---

## ğŸ“ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

### 1. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®ã®è¿½åŠ æ©Ÿèƒ½
- ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†ç”»é¢ã§é …ç›®ã‚’è¿½åŠ ãƒ»ç·¨é›†
- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®é›†è¨ˆè¡¨ç¤º
- å†™çœŸæ·»ä»˜æ©Ÿèƒ½ã®å®Ÿè£…

### 2. çµ±è¨ˆãƒ»ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- ãƒ¯ãƒ¼ã‚«ãƒ¼åˆ¥ã®ãƒã‚§ãƒƒã‚¯é”æˆç‡
- é …ç›®åˆ¥ã®å®Ÿæ–½ç‡ã‚°ãƒ©ãƒ•
- æœˆæ¬¡ãƒ»å¹´æ¬¡ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ

### 3. é€šçŸ¥æ©Ÿèƒ½
- æœªãƒã‚§ãƒƒã‚¯é …ç›®ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
- å¿…é ˆé …ç›®ã®æœªå®Œäº†ã‚¢ãƒ©ãƒ¼ãƒˆ

### 4. ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªå¯¾å¿œ
- PWAåŒ–
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ
- ã‚«ãƒ¡ãƒ©é€£æº

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `npm run build` ã§ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª
- [ ] Prisma migration ã‚’æœ¬ç•ªç’°å¢ƒã§å®Ÿè¡Œ
  ```bash
  npx prisma migrate deploy
  ```
- [ ] ç’°å¢ƒå¤‰æ•°ã®ç¢ºèªï¼ˆDATABASE_URLãªã©ï¼‰
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã®ç¢ºèª

---

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãŒä¿å­˜ã•ã‚Œãªã„
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
2. `checklistState` ãŒ null ã§ãªã„ã‹ç¢ºèª
3. APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèªï¼ˆNetwork ã‚¿ãƒ–ï¼‰

### å ±é…¬ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œãªã„
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§é‡è¤‡ãŒãªã„ã‹ç¢ºèª
   ```sql
   SELECT workerId, date, COUNT(*) 
   FROM workclock_checklist_submissions 
   GROUP BY workerId, date 
   HAVING COUNT(*) > 1;
   ```
2. é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºèªï¼ˆ`worker/[id]/page.tsx`ï¼‰

### ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è‰²ãŒè¡¨ç¤ºã•ã‚Œãªã„
1. `checklistDates` ãŒæ­£ã—ãæ¸¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒ `YYYY-MM-DD` ã‹ç¢ºèª

---

## ğŸ“š å‚è€ƒè³‡æ–™

- Prisma Documentation: https://www.prisma.io/docs
- Next.js App Router: https://nextjs.org/docs/app
- React Hook Form: https://react-hook-form.com/
- Tailwind CSS: https://tailwindcss.com/docs

---

**ä½œæˆæ—¥**: 2025-12-25  
**ä½œæˆè€…**: AI Assistant  
**ãƒ–ãƒ©ãƒ³ãƒ**: feature/business-checklist-ui  
**æœ€çµ‚ã‚³ãƒŸãƒƒãƒˆ**: c38e403
