# Gemini API セットアップガイド

このドキュメントでは、HRシステムにGemini APIを統合する方法を説明します。

## 🚀 セットアップ手順

### 1. Gemini API キーの取得

1. [Google AI Studio](https://makersuite.google.com/app/apikey) にアクセス
2. Googleアカウントでログイン
3. 「Create API Key」ボタンをクリック
4. APIキーをコピーして安全な場所に保存

### 2. 環境変数の設定

#### ローカル開発環境の場合

プロジェクトのルートディレクトリに `.env.local` ファイルを作成し、以下を追加：

```bash
GEMINI_API_KEY=your_api_key_here
```

`.env.local` ファイルは `.gitignore` に含まれているため、Gitにコミットされません。

#### 本番環境（Heroku）の場合

```bash
heroku config:set GEMINI_API_KEY=your_api_key_here -a your-app-name
```

または、Herokuダッシュボードから設定：
1. アプリのダッシュボードに移動
2. 「Settings」タブをクリック
3. 「Config Vars」セクションで「Reveal Config Vars」をクリック
4. `GEMINI_API_KEY` を追加し、値を入力

### 3. アプリケーションの再起動

環境変数を設定したら、アプリケーションを再起動します：

#### ローカル開発
```bash
# 開発サーバーを停止（Ctrl+C）してから再起動
npm run dev
```

#### Heroku
```bash
heroku restart -a your-app-name
```

## ✨ 機能の確認

### AIチャット機能が利用可能なページ

以下のページで「AIに聞く」ボタンが利用可能です：

1. **社員情報ページ** (`/employees`)
   - 社員データの操作方法
   - フィルター機能の使い方
   - 社員登録・編集の手順

2. **タスク管理ページ** (`/tasks`)
   - カンバンボードの使い方
   - ワークスペース・ボード管理
   - タスク管理の方法

3. **勤怠管理ページ** (`/attendance`)
   - 勤怠データの確認方法
   - 勤怠記録の操作

4. **給与管理ページ** (`/payroll`)
   - 給与情報の確認方法
   - 給与計算について

5. **組織図ページ** (`/organization`)
   - 組織構造の理解
   - 部署・役職について

6. **休暇管理ページ** (`/leave`)
   - 休暇申請の方法
   - 休暇残数の確認

### AIが理解できる情報

AIは以下の情報を理解して回答します：

- **現在のページ情報**: どのページにいるか
- **ユーザー情報**: ログインユーザーの名前、役職、部署、権限
- **フィルター状態**: 適用されているフィルター条件
- **表示設定**: カレンダー表示、アーカイブ表示などの状態
- **利用可能な機能**: ユーザーの権限に応じた機能一覧

### 使用例

#### 質問例 1: 基本操作
```
Q: 新しい社員を登録するにはどうすればいいですか？
A: 社員情報ページの右上にある「新規登録」ボタンをクリックすると...
```

#### 質問例 2: フィルター機能
```
Q: 営業部の社員だけを表示するには？
A: 画面上部のフィルター機能で「部署」から「営業部」を選択してください...
```

#### 質問例 3: タスク管理
```
Q: タスクに期限を設定する方法は？
A: タスクカードをクリックして詳細画面を開き、「期限」フィールドから日付を選択してください...
```

#### 質問例 4: システム横断的な質問
```
Q: 部下の勤怠状況を確認するには？
A: 勤怠管理ページに移動し、フィルターで部署や担当者を絞り込むことができます...
```

## 🔧 トラブルシューティング

### エラー: "GEMINI_API_KEYが設定されていません"

**原因**: 環境変数が正しく設定されていない

**解決方法**:
1. `.env.local` ファイルが存在し、正しいAPIキーが設定されているか確認
2. アプリケーションを再起動
3. 環境変数が正しく読み込まれているか確認：
   ```bash
   # Node.jsコンソールで確認
   console.log(process.env.GEMINI_API_KEY)
   ```

### エラー: "APIエラーが発生しました"

**原因**: APIキーが無効、またはAPIクォータ超過

**解決方法**:
1. APIキーが正しいか [Google AI Studio](https://makersuite.google.com/app/apikey) で確認
2. APIの使用制限を確認
3. 必要に応じて新しいAPIキーを生成

### AIの応答が遅い

**原因**: ネットワーク遅延、またはAPI負荷

**解決方法**:
- 通常、応答には2-5秒かかります
- 10秒以上待っても応答がない場合は、ページをリロードして再試行

## 📊 API使用制限

### 使用モデル: gemini-2.5-flash-lite

Gemini API（無料プラン）の制限：

- **リクエスト制限**: 60リクエスト/分
- **トークン制限**: モデルによって異なる
- **料金**: 一定量まで無料、超過分は従量課金
- **特徴**: 高速で軽量なモデル、応答時間が短い

詳細は [Google AI 料金ページ](https://ai.google.dev/pricing) を参照してください。

## 🔒 セキュリティ

### 重要な注意事項

1. **APIキーを公開しない**: 
   - GitHubなどにコミットしない
   - クライアントサイドのコードに含めない
   - `.env.local` は必ず `.gitignore` に含める

2. **APIキーの定期的な更新**:
   - 定期的にAPIキーをローテーション
   - 漏洩が疑われる場合は即座に無効化

3. **アクセス制限**:
   - 本番環境のAPIキーは厳重に管理
   - 環境ごとに異なるAPIキーを使用

## 💡 ベストプラクティス

### 効果的な質問の仕方

1. **具体的に質問する**:
   - ❌ 「これどうやるの？」
   - ✅ 「新しい社員を登録するにはどうすればいいですか？」

2. **コンテキストを活用する**:
   - AIは現在のページ情報を理解しています
   - そのページに関連する質問をすると、より正確な回答が得られます

3. **段階的に質問する**:
   - 複雑な操作は、ステップごとに質問する
   - 不明点があれば追加で質問する

### システム管理者向け

1. **ログの確認**:
   ```bash
   # Herokuログの確認
   heroku logs --tail -a your-app-name
   ```

2. **API使用状況の監視**:
   - [Google Cloud Console](https://console.cloud.google.com/) でAPI使用状況を確認
   - クォータの監視を設定

3. **カスタマイズ**:
   - `/app/api/ai/chat/route.ts` でシステムプロンプトをカスタマイズ可能
   - 各ページの `buildAIContext()` 関数でコンテキスト情報を調整可能

## 📚 関連ファイル

- **APIエンドポイント**: `app/api/ai/chat/route.ts`
- **チャットダイアログ**: `components/ai-chat-dialog.tsx`
- **AIボタン**: `components/ai-ask-button.tsx`
- **ページ実装例**:
  - `app/employees/page.tsx`
  - `app/tasks/page.tsx`

## 🆘 サポート

問題が解決しない場合は、以下を確認してください：

1. [Gemini API ドキュメント](https://ai.google.dev/docs)
2. [Next.js 環境変数ガイド](https://nextjs.org/docs/basic-features/environment-variables)
3. プロジェクトの GitHub Issues

---

**更新日**: 2025年10月11日
**バージョン**: 1.0.0

