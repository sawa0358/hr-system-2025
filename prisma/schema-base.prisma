// ベーススキーマ - 共通のモデル定義
// このファイルを元に、環境別のスキーマを自動生成します

generator client {
  provider = "prisma-client-js"
}

// ユーザーロール
enum UserRole {
  viewer
  general
  sub_manager
  store_manager
  manager
  hr
  admin
}

// 社員ステータス
enum EmployeeStatus {
  active
  leave
  retired
  suspended
  copy
}

// 雇用形態（有給管理用）
enum EmploymentType {
  FULL_TIME
  PART_TIME
}

// 申請単位
enum RequestUnit {
  DAY
  HOUR
}

// 申請ステータス（有給管理用詳細版）
enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

// WorkClock用 時給パターン
enum WagePattern {
  A
  B
  C
}

model Employee {
  id                    String            @id @default(cuid())
  employeeId            String            @unique
  employeeNumber        String            @unique
  employeeType          String
  name                  String
  furigana              String?
  email                 String?
  phone                 String?
  department            String
  position              String
  organization          String
  team                  String?
  joinDate              DateTime
  status                EmployeeStatus    @default(active)
  password              String
  role                  UserRole?
  myNumber              String?
  userId                String?
  url                   String?
  address               String?
  selfIntroduction      String?
  phoneInternal         String?
  phoneMobile           String?
  birthDate             DateTime?
  avatar                String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  showInOrgChart        Boolean           @default(true)
  parentEmployeeId      String?
  isInvisibleTop        Boolean           @default(false)
  isSuspended           Boolean           @default(false)
  retirementDate        DateTime?
  privacyDisplayName    Boolean           @default(true)
  privacyOrganization   Boolean           @default(true)
  privacyDepartment     Boolean           @default(true)
  privacyPosition       Boolean           @default(true)
  privacyUrl            Boolean           @default(true)
  privacyAddress        Boolean           @default(true)
  privacyBio            Boolean           @default(true)
  privacyEmail          Boolean           @default(true)
  privacyWorkPhone      Boolean           @default(true)
  privacyExtension      Boolean           @default(true)
  privacyMobilePhone    Boolean           @default(true)
  privacyBirthDate      Boolean           @default(false)
  orgChartLabel         String?
  /// 組織図の同階層内の並び順（左から0,1,2,...）
  orgChartOrder         Int?
  description           String?
  
  // 有給管理用フィールド
  employmentType        EmploymentType?  // 雇用形態（FULL_TIME or PART_TIME）
  weeklyPattern         Int?             // 週の所定勤務日数（1-4、PART_TIMEのみ必須）
  configVersion         String?          // 使用中の設定バージョン
  vacationPattern       String?           // 有給計算パターン（"A", "B-1", "B-2", "B-3", "B-4"）
  
  // リレーション
  evaluations           Evaluation[]
  attendance            Attendance[]
  payroll               Payroll[]
  files                 File[]
  folders               Folder[]
  activityLogs          ActivityLog[]
  leaveRequests         LeaveRequest[]
  vacationBalances      VacationBalance[]
  vacationRequests      VacationRequest[]
  
  // 有給管理（ロットベース）関係
  grantLots             GrantLot[]
  consumptions          Consumption[]
  timeOffRequests       TimeOffRequest[]
  alertEvents           AlertEvent[]
  auditLogs             AuditLog[]
  convenienceCategoriesCreated ConvenienceCategory[] @relation("ConvenienceCategoryCreatedBy")
  convenienceCategoriesUpdated ConvenienceCategory[] @relation("ConvenienceCategoryUpdatedBy")
  convenienceEntriesCreated    ConvenienceEntry[]    @relation("ConvenienceEntryCreatedBy")
  convenienceEntriesUpdated    ConvenienceEntry[]    @relation("ConvenienceEntryUpdatedBy")
  
  // ワークスペース関係
  workspaceMembers      WorkspaceMember[]
  createdWorkspaces     Workspace[] @relation("WorkspaceCreator")
  
  // タスク関係
  assignedTasks         Task[] @relation("TaskAssignee")
  taskMembers           TaskMember[]
  
  // カード関係
  createdCards          Card[] @relation("CardCreator")
  cardMembers           CardMember[]
  
  // ボード関係
  createdBoards         Board[] @relation("BoardCreator")
  
  // カスタムフォルダ関係
  customFolders         CustomFolder[] @relation("CustomFolderEmployee")
  
  // ユーザー設定関係
  userSettings          UserSettings[] @relation("UserSettingsEmployee")
  
  // 家族構成関係
  familyMembers         FamilyMember[]

  // WorkClock（業務委託時間管理）関係
  workClockWorkers      WorkClockWorker[]

  @@map("employees")
}

model Evaluation {
  id            String   @id @default(cuid())
  employeeId    String
  employee      Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  period        String
  evaluator     String
  status        String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("evaluations")
}

model Task {
  id          String   @id @default(cuid())
  title       String
  description String?
  status      String   @default("todo")
  priority    String   @default("medium")
  dueDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  employeeId  String
  employee    Employee @relation("TaskAssignee", fields: [employeeId], references: [id], onDelete: Cascade)
  members     TaskMember[]

  @@map("tasks")
}

model TaskMember {
  id        String   @id @default(cuid())
  taskId    String
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  employeeId String
  employee  Employee @relation(fields: [employeeId], references: [id])
  createdAt DateTime @default(now())

  @@unique([taskId, employeeId])
  @@map("task_members")
}

model Attendance {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  date       DateTime
  clockIn    DateTime?
  clockOut   DateTime?
  breakStart DateTime?
  breakEnd   DateTime?
  status     String   @default("present")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("attendance")
}

model Payroll {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  period     String
  amount     Float
  status     String   @default("pending")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("payroll")
}

model File {
  id           String   @id @default(cuid())
  employeeId   String
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  originalName String
  filename     String
  filePath     String?
  s3Key        String?
  mimeType     String
  fileSize     Int
  category     String
  folderName   String?
  taskId       String?
  createdAt    DateTime @default(now())

  @@map("files")
}

model Folder {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  name       String
  parentId   String?
  parent     Folder?  @relation("FolderHierarchy", fields: [parentId], references: [id])
  children   Folder[] @relation("FolderHierarchy")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("folders")
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String
  user      Employee @relation(fields: [userId], references: [id], onDelete: Cascade)
  userName  String
  action    String
  module    String
  details   String
  metadata  Json?
  createdAt DateTime @default(now())

  @@map("activity_logs")
}

model LeaveRequest {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  startDate  DateTime
  endDate    DateTime
  type       String
  reason     String?
  status     String   @default("pending")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("leave_requests")
}

model Workspace {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdBy   String?
  creator     Employee? @relation("WorkspaceCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  members     WorkspaceMember[]
  boards      Board[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("workspaces")
}

model WorkspaceMember {
  id          String    @id @default(cuid())
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  role        String    @default("member")
  createdAt   DateTime  @default(now())

  @@unique([workspaceId, employeeId])
  @@map("workspace_members")
}

model Board {
  id          String   @id @default(cuid())
  name        String
  description String?
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  createdBy   String?
  creator     Employee? @relation("BoardCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  position    Int      @default(0)
  lists       BoardList[]
  cards       Card[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("boards")
}

model BoardList {
  id        String   @id @default(cuid())
  title     String
  position  Int
  boardId   String
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  cards     Card[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("board_lists")
}

model Card {
  id          String   @id @default(cuid())
  title       String
  description String?
  position    Int
  listId      String
  list        BoardList @relation(fields: [listId], references: [id], onDelete: Cascade)
  boardId     String
  board       Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  createdBy   String?
  creator     Employee? @relation("CardCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  members     CardMember[]
  attachments Json?
  labels      Json?
  checklists  Json?
  dueDate     DateTime?
  priority    String   @default("medium")
  status      String   @default("todo")
  cardColor   String?
  isArchived  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("cards")
}

model CardMember {
  id         String   @id @default(cuid())
  cardId     String
  card       Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])
  createdAt  DateTime @default(now())

  @@unique([cardId, employeeId])
  @@map("card_members")
}

model FamilyMember {
  id           String   @id @default(cuid())
  employeeId   String
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  name         String
  relationship String
  birthDate    DateTime?
  phone        String?
  address      String?
  myNumber     String?
  description  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("family_members")
}

model CustomFolder {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation("CustomFolderEmployee", fields: [employeeId], references: [id], onDelete: Cascade)
  category   String   @default("employee")
  name       String
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("custom_folders")
}

model UserSettings {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation("UserSettingsEmployee", fields: [employeeId], references: [id], onDelete: Cascade)
  key        String
  value      String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([employeeId, key])
  @@map("user_settings")
}

model MasterData {
  id        String   @id @default(cuid())
  type      String   // 'department', 'position', 'employeeType', 'organization'
  value     String
  label     String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([type, value])
  @@map("master_data")
}

// ==========================
// 有給管理用 追加モデル
// ==========================

model VacationSettings {
  id                   String   @id @default(cuid())

  // 基本設定
  initialGrantPeriod   Int      // 初回付与までの期間（月）
  grantPeriod          Int      // 付与間隔（月）
  carryOverLimit       Int      // 繰越上限日数
  validityYears        Int      // 有効期間（年）
  minimumMandatoryDays Int      // 最低取得日数（義務）

  // 正社員設定
  fullTimeGrantDays    Int      // 正社員付与日数（A値）

  // パート社員設定（週勤務日数別）
  partTime1DayGrant    Int      // 週1日勤務時の付与日数
  partTime2DayGrant    Int      // 週2日勤務時の付与日数
  partTime3DayGrant    Int      // 週3日勤務時の付与日数
  partTime4DayGrant    Int      // 週4日勤務時の付与日数

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("vacation_settings")
}

model VacationGrantSchedule {
  id                String   @id @default(cuid())

  // 勤続年数別付与日数設定
  serviceYears      Float
  fullTimeGrantDays Int

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("vacation_grant_schedule")
}

model PartTimeGrantSchedule {
  id              String   @id @default(cuid())

  // 勤続年数と週勤務日数別設定
  serviceDays     Int
  workDaysPerWeek Int
  grantDays       Int
  annualMinDays   Int      // 年間勤務日数（最小）
  annualMaxDays   Int      // 年間勤務日数（最大）

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([serviceDays, workDaysPerWeek])
  @@map("parttime_grant_schedule")
}

model VacationBalance {
  id            String   @id @default(cuid())
  employeeId    String

  grantDate     DateTime  // 付与日
  grantDays     Int       // 付与日数
  remainingDays Float     // 残日数
  expiryDate    DateTime  // 有効期限
  isExpired     Boolean   @default(false)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  employee      Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  usages        VacationUsage[]

  @@index([employeeId, grantDate])
  @@map("vacation_balances")
}

model VacationRequest {
  id           String         @id @default(cuid())
  employeeId   String

  startDate    DateTime
  endDate      DateTime
  usedDays     Float
  reason       String?
  status       RequestStatus

  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  employee     Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  usageDetails VacationUsage[]

  @@map("vacation_requests")
}

model VacationUsage {
  id        String           @id @default(cuid())
  requestId String
  balanceId String
  usedDays  Float

  createdAt DateTime         @default(now())

  request   VacationRequest  @relation(fields: [requestId], references: [id], onDelete: Cascade)
  balance   VacationBalance  @relation(fields: [balanceId], references: [id], onDelete: Cascade)

  @@map("vacation_usage")
}

model AlertSettings {
  id                     String   @id @default(cuid())
  
  // 3ヶ月前アラート
  alert3MonthsBefore     Boolean  @default(true)
  alert3MonthsThreshold  Int      @default(5)
  
  // 2ヶ月前アラート
  alert2MonthsBefore     Boolean  @default(true)
  alert2MonthsThreshold  Int      @default(3)
  
  // 1ヶ月前アラート
  alert1MonthBefore      Boolean  @default(true)
  alert1MonthThreshold   Int      @default(5)
  
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  
  @@map("alert_settings")
}

// ==========================
// ロットベース有給管理モデル（設計メモ準拠）
// ==========================

// 付与ロット: ある基準日に付与されたN日・有効期限付きのかたまり
model GrantLot {
  id            String   @id @default(cuid())
  employeeId    String
  employee      Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  grantDate     DateTime
  daysGranted   Decimal  // 小数対応（時間休は別換算で格納可）
  daysRemaining Decimal
  expiryDate    DateTime
  // 冪等性: 同一基準日時の再計算で重複を避けるため
  dedupKey      String   @unique // employeeId + grantDate + daysGranted + configVersion 等のハッシュ
  configVersion String?  // 使用した設定バージョン
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  consumptions  Consumption[]
  
  @@index([employeeId, grantDate])
  @@map("grant_lots")
}

// 消化トランザクション: 申請承認により消費された日数（どのロットから何日使ったかの明細）
model Consumption {
  id             String   @id @default(cuid())
  employeeId     String
  employee       Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  requestId      String
  request        TimeOffRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  lotId          String
  lot            GrantLot @relation(fields: [lotId], references: [id], onDelete: Cascade)
  date           DateTime // 実際の休暇日（複数日に跨ぐ場合は1日=1行 or hoursで分解）
  daysUsed       Decimal  // 1 or 0.5 など（時間休は日換算）
  createdAt      DateTime @default(now())
  
  @@index([employeeId, date])
  @@index([lotId])
  @@index([requestId])
  @@map("consumptions")
}

// 有給申請（詳細版）
model TimeOffRequest {
  id             String   @id @default(cuid())
  employeeId     String
  employee       Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  // 申請情報
  startDate      DateTime
  endDate        DateTime
  unit           RequestUnit // DAY or HOUR
  hoursPerDay    Int?        // 時間休計算用（会社の1日=8h等）
  status         RequestStatus @default(PENDING)
  approvedAt     DateTime?
  // 承認フロー用フィールド
  supervisorId   String?      // 選択した上司ID（必須）
  approvedBy     String?      // 上司承認者ID
  finalizedBy    String?      // 総務・管理者決済者ID
  // 計算スナップショット
  totalDays      Decimal?     // 承認時に確定
  breakdownJson String?      // どのlotから何日使ったか（LIFO結果）をJSONで残す
  reason         String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  consumptions   Consumption[]
  
  @@index([employeeId])
  @@index([supervisorId])
  @@map("time_off_requests")
}

// アラートイベント
model AlertEvent {
  id            String   @id @default(cuid())
  employeeId    String
  employee      Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  kind          String   // e.g., "UNDER_USED_AT_3M_BEFORE"
  referenceDate DateTime // 判定を行った基準日
  details       String   // JSON: { checkpoint, consumed, required }
  createdAt     DateTime @default(now())
  
  @@unique([employeeId, kind, referenceDate])
  @@index([employeeId])
  @@map("alert_events")
}

// 監査ログ
model AuditLog {
  id            String   @id @default(cuid())
  employeeId    String?
  employee      Employee? @relation(fields: [employeeId], references: [id], onDelete: SetNull)
  actor         String   // system | user:{id}
  action        String   // GRANT_CREATE / REQUEST_APPROVE / RECALC ...
  entity        String   // GrantLot:xxx 等
  payload       String   // JSON
  createdAt     DateTime @default(now())
  
  @@index([employeeId])
  @@index([action])
  @@map("audit_logs")
}

// 有給管理設定（AppConfig）
model VacationAppConfig {
  id            String   @id @default(cuid())
  version       String   @unique // 設定バージョン（主キー相当）
  configJson    String   // AppConfigのJSON表現
  isActive      Boolean  @default(false) // 現在使用中の設定
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("vacation_app_configs")
}

model BulletinCategory {
  id        String     @id @default(cuid())
  name      String     @unique
  color     String     @default("secondary")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  bulletins Bulletin[]

  @@map("bulletin_categories")
}

model Bulletin {
  id          String            @id @default(cuid())
  title       String
  content     String
  pinned      Boolean           @default(false)
  publishedAt DateTime          @default(now())
  categoryId  String?
  category    BulletinCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([publishedAt])
  @@map("bulletins")
}

// ==========================
// 便利機能（Convenience）
// ==========================

model ConvenienceCategory {
  id            String   @id @default(cuid())
  tenantId      String?
  name          String
  position      Int      @default(0)
  isArchived    Boolean  @default(false)
  isAdminOnly   Boolean  @default(false)
  deletedAt     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String?
  updatedBy     String?
  createdByUser Employee? @relation("ConvenienceCategoryCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser Employee? @relation("ConvenienceCategoryUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  entries       ConvenienceEntry[]

  @@index([tenantId, position])
  @@map("convenience_categories")
}

model ConvenienceEntry {
  id            String   @id @default(cuid())
  categoryId    String
  category      ConvenienceCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  title         String
  note          String?
  position      Int      @default(0)
  isArchived    Boolean  @default(false)
  isAdminOnly   Boolean  @default(false)
  deletedAt     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String?
  updatedBy     String?
  createdByUser Employee? @relation("ConvenienceEntryCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser Employee? @relation("ConvenienceEntryUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  urls          ConvenienceEntryUrl[]

  @@index([categoryId, position])
  @@map("convenience_entries")
}

model ConvenienceEntryUrl {
  id          String   @id @default(cuid())
  entryId     String
  entry       ConvenienceEntry @relation(fields: [entryId], references: [id], onDelete: Cascade)
  url         String
  description String?
  position    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([entryId, position])
  @@map("convenience_entry_urls")
}

// ==========================
// WorkClock（業務委託時間管理）用モデル
// ==========================

model WorkClockWorker {
  id                     String   @id @default(cuid())
  employeeId             String   @unique
  employee               Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  name                   String
  password               String?
  companyName            String?
  qualifiedInvoiceNumber String?
  chatworkId             String?
  email                  String
  phone                  String?
  address                String?
  hourlyRate             Float
  // 時給パターン名（ラベル）
  wagePatternLabelA      String?  @default("Aパターン")
  wagePatternLabelB      String?  @default("Bパターン")
  wagePatternLabelC      String?  @default("Cパターン")
  // 追加の時給パターン金額（任意）
  hourlyRateB            Float?
  hourlyRateC            Float?
  // 回数ベースの支払いパターン（任意）
  countPatternLabelA     String?  @default("回数Aパターン")
  countPatternLabelB     String?  @default("回数Bパターン")
  countPatternLabelC     String?  @default("回数Cパターン")
  // 回数パターン金額（任意）
  countRateA             Float?
  countRateB             Float?
  countRateC             Float?
  // 月額固定（金額とON/OFF）
  monthlyFixedAmount     Int?
  monthlyFixedEnabled    Boolean  @default(false)
  // 消費税設定
  billingTaxEnabled      Boolean  @default(false) // 消費税を請求に反映するか
  billingTaxRate         Float?                // 個別の消費税率（例: 10.0）。未設定時は標準税率を使用
  taxType                String   @default("exclusive") // 'exclusive'（外税）| 'inclusive'（内税）
  // 源泉徴収設定
  withholdingTaxEnabled  Boolean  @default(false) // 源泉徴収対象かどうか
  teams                  String?  // JSON文字列（string[]）
  role                   String   @default("worker") // 'worker' | 'admin'
  notes                  String?
  transferDestination    String? // 振込先
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  timeEntries            WorkClockTimeEntry[]
  rewards                WorkClockReward[]
  rewardPresets          WorkClockRewardPreset[]

  @@map("workclock_workers")
}

model WorkClockTimeEntry {
  id           String       @id @default(cuid())
  workerId     String
  worker       WorkClockWorker @relation(fields: [workerId], references: [id], onDelete: Cascade)
  date         DateTime
  // 時給パターン（任意。A/B/Cのいずれか）
  wagePattern  WagePattern? @default(A)
  startTime    String
  endTime      String
  breakMinutes Int          @default(0)
  notes        String?
  // 回数パターン（時給パターンと併用可能）
  countPattern WagePattern?
  count        Int?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@index([workerId, date])
  @@map("workclock_time_entries")
}

model WorkClockReward {
  id          String          @id @default(cuid())
  workerId    String
  worker      WorkClockWorker @relation(fields: [workerId], references: [id], onDelete: Cascade)
  amount      Int
  description String
  date        DateTime
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([workerId, date])
  @@map("workclock_rewards")
}

model WorkClockRewardPreset {
  id          String          @id @default(cuid())
  workerId    String
  worker      WorkClockWorker @relation(fields: [workerId], references: [id], onDelete: Cascade)
  amount      Int
  description String
  isEnabled   Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([workerId])
  @@map("workclock_reward_presets")
}

model WorkClockTeam {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("workclock_teams")
}
