// âš ï¸âš ï¸âš ï¸ é‡è¦: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆã‚·ã‚¹ãƒ†ãƒ  âš ï¸âš ï¸âš ï¸
//
// ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
// è©³ç´°ã¯ DATABASE_AUTO_SWITCH.md ã‚’å¿…ãšå‚ç…§ã—ã¦ãã ã•ã„
//
// ğŸ”„ è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ:
//   - é–‹ç™ºæ™‚: npm run dev â†’ è‡ªå‹•çš„ã« "sqlite" ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™
//   - æœ¬ç•ªæ™‚: git push heroku main â†’ è‡ªå‹•çš„ã« "postgresql" ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™
//
// âš ï¸ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã® provider ã‚’æ‰‹å‹•ã§ç·¨é›†ã—ãªã„ã§ãã ã•ã„
// âš ï¸ ã™ã¹ã¦è‡ªå‹•åŒ–ã•ã‚Œã¦ã„ã¾ã™
//
// ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ - å…±é€šã®ãƒ¢ãƒ‡ãƒ«å®šç¾©
// ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ã€ç’°å¢ƒåˆ¥ã®ã‚¹ã‚­ãƒ¼ãƒã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«
enum UserRole {
  viewer
  general
  sub_manager
  store_manager
  manager
  hr
  admin
}

// ç¤¾å“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
enum EmployeeStatus {
  active
  leave
  retired
  suspended
  copy
}

// é›‡ç”¨å½¢æ…‹ï¼ˆæœ‰çµ¦ç®¡ç†ç”¨ï¼‰
enum EmploymentType {
  FULL_TIME
  PART_TIME
}

// ç”³è«‹å˜ä½
enum RequestUnit {
  DAY
  HOUR
}

// ç”³è«‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæœ‰çµ¦ç®¡ç†ç”¨è©³ç´°ç‰ˆï¼‰
enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

// WorkClockç”¨ æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³
enum WagePattern {
  A
  B
  C
}

model Employee {
  id                  String         @id @default(cuid())
  employeeId          String         @unique
  employeeNumber      String         @unique
  employeeType        String
  name                String
  furigana            String?
  email               String?
  phone               String?
  department          String
  position            String
  organization        String
  team                String?
  joinDate            DateTime
  status              EmployeeStatus @default(active)
  password            String
  role                UserRole?
  myNumber            String?
  userId              String?
  url                 String?
  address             String?
  selfIntroduction    String?
  phoneInternal       String?
  phoneMobile         String?
  birthDate           DateTime?
  avatar              String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  showInOrgChart      Boolean        @default(true)
  parentEmployeeId    String?
  isInvisibleTop      Boolean        @default(false)
  isSuspended         Boolean        @default(false)
  retirementDate      DateTime?
  privacyDisplayName  Boolean        @default(true)
  privacyOrganization Boolean        @default(true)
  privacyDepartment   Boolean        @default(true)
  privacyPosition     Boolean        @default(true)
  privacyUrl          Boolean        @default(true)
  privacyAddress      Boolean        @default(true)
  privacyBio          Boolean        @default(true)
  privacyEmail        Boolean        @default(true)
  privacyWorkPhone    Boolean        @default(true)
  privacyExtension    Boolean        @default(true)
  privacyMobilePhone  Boolean        @default(true)
  privacyBirthDate    Boolean        @default(false)
  orgChartLabel       String?
  /// çµ„ç¹”å›³ã®åŒéšå±¤å†…ã®ä¸¦ã³é †ï¼ˆå·¦ã‹ã‚‰0,1,2,...ï¼‰
  orgChartOrder       Int?
  description         String?

  // æœ‰çµ¦ç®¡ç†ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  employmentType  EmploymentType? // é›‡ç”¨å½¢æ…‹ï¼ˆFULL_TIME or PART_TIMEï¼‰
  weeklyPattern   Int? // é€±ã®æ‰€å®šå‹¤å‹™æ—¥æ•°ï¼ˆ1-4ã€PART_TIMEã®ã¿å¿…é ˆï¼‰
  configVersion   String? // ä½¿ç”¨ä¸­ã®è¨­å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³
  vacationPattern String? // æœ‰çµ¦è¨ˆç®—ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ"A", "B-1", "B-2", "B-3", "B-4"ï¼‰

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  evaluations      Evaluation[]
  attendance       Attendance[]
  payroll          Payroll[]
  files            File[]
  folders          Folder[]
  activityLogs     ActivityLog[]
  leaveRequests    LeaveRequest[]
  vacationBalances VacationBalance[]
  vacationRequests VacationRequest[]

  // æœ‰çµ¦ç®¡ç†ï¼ˆãƒ­ãƒƒãƒˆãƒ™ãƒ¼ã‚¹ï¼‰é–¢ä¿‚
  grantLots                    GrantLot[]
  consumptions                 Consumption[]
  timeOffRequests              TimeOffRequest[]
  alertEvents                  AlertEvent[]
  auditLogs                    AuditLog[]
  convenienceCategoriesCreated ConvenienceCategory[] @relation("ConvenienceCategoryCreatedBy")
  convenienceCategoriesUpdated ConvenienceCategory[] @relation("ConvenienceCategoryUpdatedBy")
  convenienceEntriesCreated    ConvenienceEntry[]    @relation("ConvenienceEntryCreatedBy")
  convenienceEntriesUpdated    ConvenienceEntry[]    @relation("ConvenienceEntryUpdatedBy")

  // ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹é–¢ä¿‚
  workspaceMembers  WorkspaceMember[]
  createdWorkspaces Workspace[]       @relation("WorkspaceCreator")

  // ã‚¿ã‚¹ã‚¯é–¢ä¿‚
  assignedTasks Task[]       @relation("TaskAssignee")
  taskMembers   TaskMember[]

  // ã‚«ãƒ¼ãƒ‰é–¢ä¿‚
  createdCards Card[]       @relation("CardCreator")
  cardMembers  CardMember[]

  // ãƒœãƒ¼ãƒ‰é–¢ä¿‚
  createdBoards Board[] @relation("BoardCreator")

  // ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ«ãƒ€é–¢ä¿‚
  customFolders CustomFolder[] @relation("CustomFolderEmployee")

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šé–¢ä¿‚
  userSettings UserSettings[] @relation("UserSettingsEmployee")

  // å®¶æ—æ§‹æˆé–¢ä¿‚
  familyMembers FamilyMember[]

  // WorkClockï¼ˆæ¥­å‹™å§”è¨—æ™‚é–“ç®¡ç†ï¼‰é–¢ä¿‚
  workClockWorkers WorkClockWorker[]

  @@map("employees")
}

model Evaluation {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  period     String
  evaluator  String
  status     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("evaluations")
}

model Task {
  id          String       @id @default(cuid())
  title       String
  description String?
  status      String       @default("todo")
  priority    String       @default("medium")
  dueDate     DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  employeeId  String
  employee    Employee     @relation("TaskAssignee", fields: [employeeId], references: [id], onDelete: Cascade)
  members     TaskMember[]

  @@map("tasks")
}

model TaskMember {
  id         String   @id @default(cuid())
  taskId     String
  task       Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])
  createdAt  DateTime @default(now())

  @@unique([taskId, employeeId])
  @@map("task_members")
}

model Attendance {
  id         String    @id @default(cuid())
  employeeId String
  employee   Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  date       DateTime
  clockIn    DateTime?
  clockOut   DateTime?
  breakStart DateTime?
  breakEnd   DateTime?
  status     String    @default("present")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@map("attendance")
}

model Payroll {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  period     String
  amount     Float
  status     String   @default("pending")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("payroll")
}

model File {
  id           String   @id @default(cuid())
  employeeId   String
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  originalName String
  filename     String
  filePath     String?
  s3Key        String?
  mimeType     String
  fileSize     Int
  category     String
  folderName   String?
  taskId       String?
  createdAt    DateTime @default(now())

  @@map("files")
}

model Folder {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  name       String
  parentId   String?
  parent     Folder?  @relation("FolderHierarchy", fields: [parentId], references: [id])
  children   Folder[] @relation("FolderHierarchy")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("folders")
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String
  user      Employee @relation(fields: [userId], references: [id], onDelete: Cascade)
  userName  String
  action    String
  module    String
  details   String
  metadata  Json?
  createdAt DateTime @default(now())

  @@map("activity_logs")
}

model LeaveRequest {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  startDate  DateTime
  endDate    DateTime
  type       String
  reason     String?
  status     String   @default("pending")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("leave_requests")
}

model Workspace {
  id          String            @id @default(cuid())
  name        String
  description String?
  createdBy   String?
  creator     Employee?         @relation("WorkspaceCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  members     WorkspaceMember[]
  boards      Board[]
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@map("workspaces")
}

model WorkspaceMember {
  id          String    @id @default(cuid())
  workspaceId String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  role        String    @default("member")
  createdAt   DateTime  @default(now())

  @@unique([workspaceId, employeeId])
  @@map("workspace_members")
}

model Board {
  id          String      @id @default(cuid())
  name        String
  description String?
  workspaceId String
  workspace   Workspace   @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  createdBy   String?
  creator     Employee?   @relation("BoardCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  position    Int         @default(0)
  lists       BoardList[]
  cards       Card[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("boards")
}

model BoardList {
  id        String   @id @default(cuid())
  title     String
  position  Int
  boardId   String
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  cards     Card[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("board_lists")
}

model Card {
  id          String       @id @default(cuid())
  title       String
  description String?
  position    Int
  listId      String
  list        BoardList    @relation(fields: [listId], references: [id], onDelete: Cascade)
  boardId     String
  board       Board        @relation(fields: [boardId], references: [id], onDelete: Cascade)
  createdBy   String?
  creator     Employee?    @relation("CardCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  members     CardMember[]
  attachments Json?
  labels      Json?
  checklists  Json?
  dueDate     DateTime?
  priority    String       @default("medium")
  status      String       @default("todo")
  cardColor   String?
  isArchived  Boolean      @default(false)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@map("cards")
}

model CardMember {
  id         String   @id @default(cuid())
  cardId     String
  card       Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])
  createdAt  DateTime @default(now())

  @@unique([cardId, employeeId])
  @@map("card_members")
}

model FamilyMember {
  id           String    @id @default(cuid())
  employeeId   String
  employee     Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  name         String
  relationship String
  birthDate    DateTime?
  phone        String?
  address      String?
  myNumber     String?
  description  String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@map("family_members")
}

model CustomFolder {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation("CustomFolderEmployee", fields: [employeeId], references: [id], onDelete: Cascade)
  category   String   @default("employee")
  name       String
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("custom_folders")
}

model UserSettings {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation("UserSettingsEmployee", fields: [employeeId], references: [id], onDelete: Cascade)
  key        String
  value      String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([employeeId, key])
  @@map("user_settings")
}

model MasterData {
  id        String   @id @default(cuid())
  type      String // 'department', 'position', 'employeeType', 'organization'
  value     String
  label     String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([type, value])
  @@map("master_data")
}

// ==========================
// æœ‰çµ¦ç®¡ç†ç”¨ è¿½åŠ ãƒ¢ãƒ‡ãƒ«
// ==========================

model VacationSettings {
  id String @id @default(cuid())

  // åŸºæœ¬è¨­å®š
  initialGrantPeriod   Int // åˆå›ä»˜ä¸ã¾ã§ã®æœŸé–“ï¼ˆæœˆï¼‰
  grantPeriod          Int // ä»˜ä¸é–“éš”ï¼ˆæœˆï¼‰
  carryOverLimit       Int // ç¹°è¶Šä¸Šé™æ—¥æ•°
  validityYears        Int // æœ‰åŠ¹æœŸé–“ï¼ˆå¹´ï¼‰
  minimumMandatoryDays Int // æœ€ä½å–å¾—æ—¥æ•°ï¼ˆç¾©å‹™ï¼‰

  // æ­£ç¤¾å“¡è¨­å®š
  fullTimeGrantDays Int // æ­£ç¤¾å“¡ä»˜ä¸æ—¥æ•°ï¼ˆAå€¤ï¼‰

  // ãƒ‘ãƒ¼ãƒˆç¤¾å“¡è¨­å®šï¼ˆé€±å‹¤å‹™æ—¥æ•°åˆ¥ï¼‰
  partTime1DayGrant Int // é€±1æ—¥å‹¤å‹™æ™‚ã®ä»˜ä¸æ—¥æ•°
  partTime2DayGrant Int // é€±2æ—¥å‹¤å‹™æ™‚ã®ä»˜ä¸æ—¥æ•°
  partTime3DayGrant Int // é€±3æ—¥å‹¤å‹™æ™‚ã®ä»˜ä¸æ—¥æ•°
  partTime4DayGrant Int // é€±4æ—¥å‹¤å‹™æ™‚ã®ä»˜ä¸æ—¥æ•°

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("vacation_settings")
}

model VacationGrantSchedule {
  id String @id @default(cuid())

  // å‹¤ç¶šå¹´æ•°åˆ¥ä»˜ä¸æ—¥æ•°è¨­å®š
  serviceYears      Float
  fullTimeGrantDays Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("vacation_grant_schedule")
}

model PartTimeGrantSchedule {
  id String @id @default(cuid())

  // å‹¤ç¶šå¹´æ•°ã¨é€±å‹¤å‹™æ—¥æ•°åˆ¥è¨­å®š
  serviceDays     Int
  workDaysPerWeek Int
  grantDays       Int
  annualMinDays   Int // å¹´é–“å‹¤å‹™æ—¥æ•°ï¼ˆæœ€å°ï¼‰
  annualMaxDays   Int // å¹´é–“å‹¤å‹™æ—¥æ•°ï¼ˆæœ€å¤§ï¼‰

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([serviceDays, workDaysPerWeek])
  @@map("parttime_grant_schedule")
}

model VacationBalance {
  id         String @id @default(cuid())
  employeeId String

  grantDate     DateTime // ä»˜ä¸æ—¥
  grantDays     Int // ä»˜ä¸æ—¥æ•°
  remainingDays Float // æ®‹æ—¥æ•°
  expiryDate    DateTime // æœ‰åŠ¹æœŸé™
  isExpired     Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  employee Employee        @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  usages   VacationUsage[]

  @@index([employeeId, grantDate])
  @@map("vacation_balances")
}

model VacationRequest {
  id         String @id @default(cuid())
  employeeId String

  startDate DateTime
  endDate   DateTime
  usedDays  Float
  reason    String?
  status    RequestStatus

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  employee     Employee        @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  usageDetails VacationUsage[]

  @@map("vacation_requests")
}

model VacationUsage {
  id        String @id @default(cuid())
  requestId String
  balanceId String
  usedDays  Float

  createdAt DateTime @default(now())

  request VacationRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  balance VacationBalance @relation(fields: [balanceId], references: [id], onDelete: Cascade)

  @@map("vacation_usage")
}

model AlertSettings {
  id String @id @default(cuid())

  // 3ãƒ¶æœˆå‰ã‚¢ãƒ©ãƒ¼ãƒˆ
  alert3MonthsBefore    Boolean @default(true)
  alert3MonthsThreshold Int     @default(5)

  // 2ãƒ¶æœˆå‰ã‚¢ãƒ©ãƒ¼ãƒˆ
  alert2MonthsBefore    Boolean @default(true)
  alert2MonthsThreshold Int     @default(3)

  // 1ãƒ¶æœˆå‰ã‚¢ãƒ©ãƒ¼ãƒˆ
  alert1MonthBefore    Boolean @default(true)
  alert1MonthThreshold Int     @default(5)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("alert_settings")
}

// ==========================
// ãƒ­ãƒƒãƒˆãƒ™ãƒ¼ã‚¹æœ‰çµ¦ç®¡ç†ãƒ¢ãƒ‡ãƒ«ï¼ˆè¨­è¨ˆãƒ¡ãƒ¢æº–æ‹ ï¼‰
// ==========================

// ä»˜ä¸ãƒ­ãƒƒãƒˆ: ã‚ã‚‹åŸºæº–æ—¥ã«ä»˜ä¸ã•ã‚ŒãŸNæ—¥ãƒ»æœ‰åŠ¹æœŸé™ä»˜ãã®ã‹ãŸã¾ã‚Š
model GrantLot {
  id            String   @id @default(cuid())
  employeeId    String
  employee      Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  grantDate     DateTime
  daysGranted   Decimal // å°æ•°å¯¾å¿œï¼ˆæ™‚é–“ä¼‘ã¯åˆ¥æ›ç®—ã§æ ¼ç´å¯ï¼‰
  daysRemaining Decimal
  expiryDate    DateTime
  // å†ªç­‰æ€§: åŒä¸€åŸºæº–æ—¥æ™‚ã®å†è¨ˆç®—ã§é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚
  dedupKey      String   @unique // employeeId + grantDate + daysGranted + configVersion ç­‰ã®ãƒãƒƒã‚·ãƒ¥
  configVersion String? // ä½¿ç”¨ã—ãŸè¨­å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  consumptions Consumption[]

  @@index([employeeId, grantDate])
  @@map("grant_lots")
}

// æ¶ˆåŒ–ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³: ç”³è«‹æ‰¿èªã«ã‚ˆã‚Šæ¶ˆè²»ã•ã‚ŒãŸæ—¥æ•°ï¼ˆã©ã®ãƒ­ãƒƒãƒˆã‹ã‚‰ä½•æ—¥ä½¿ã£ãŸã‹ã®æ˜ç´°ï¼‰
model Consumption {
  id         String         @id @default(cuid())
  employeeId String
  employee   Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  requestId  String
  request    TimeOffRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  lotId      String
  lot        GrantLot       @relation(fields: [lotId], references: [id], onDelete: Cascade)
  date       DateTime // å®Ÿéš›ã®ä¼‘æš‡æ—¥ï¼ˆè¤‡æ•°æ—¥ã«è·¨ãå ´åˆã¯1æ—¥=1è¡Œ or hoursã§åˆ†è§£ï¼‰
  daysUsed   Decimal // 1 or 0.5 ãªã©ï¼ˆæ™‚é–“ä¼‘ã¯æ—¥æ›ç®—ï¼‰
  createdAt  DateTime       @default(now())

  @@index([employeeId, date])
  @@index([lotId])
  @@index([requestId])
  @@map("consumptions")
}

// æœ‰çµ¦ç”³è«‹ï¼ˆè©³ç´°ç‰ˆï¼‰
model TimeOffRequest {
  id            String        @id @default(cuid())
  employeeId    String
  employee      Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  // ç”³è«‹æƒ…å ±
  startDate     DateTime
  endDate       DateTime
  unit          RequestUnit // DAY or HOUR
  hoursPerDay   Int? // æ™‚é–“ä¼‘è¨ˆç®—ç”¨ï¼ˆä¼šç¤¾ã®1æ—¥=8hç­‰ï¼‰
  status        RequestStatus @default(PENDING)
  approvedAt    DateTime?
  // æ‰¿èªãƒ•ãƒ­ãƒ¼ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  supervisorId  String? // é¸æŠã—ãŸä¸Šå¸IDï¼ˆå¿…é ˆï¼‰
  approvedBy    String? // ä¸Šå¸æ‰¿èªè€…ID
  finalizedBy   String? // ç·å‹™ãƒ»ç®¡ç†è€…æ±ºæ¸ˆè€…ID
  // è¨ˆç®—ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
  totalDays     Decimal? // æ‰¿èªæ™‚ã«ç¢ºå®š
  breakdownJson String? // ã©ã®lotã‹ã‚‰ä½•æ—¥ä½¿ã£ãŸã‹ï¼ˆLIFOçµæœï¼‰ã‚’JSONã§æ®‹ã™
  reason        String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  consumptions Consumption[]

  @@index([employeeId])
  @@index([supervisorId])
  @@map("time_off_requests")
}

// ã‚¢ãƒ©ãƒ¼ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ
model AlertEvent {
  id            String   @id @default(cuid())
  employeeId    String
  employee      Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  kind          String // e.g., "UNDER_USED_AT_3M_BEFORE"
  referenceDate DateTime // åˆ¤å®šã‚’è¡Œã£ãŸåŸºæº–æ—¥
  details       String // JSON: { checkpoint, consumed, required }
  createdAt     DateTime @default(now())

  @@unique([employeeId, kind, referenceDate])
  @@index([employeeId])
  @@map("alert_events")
}

// ç›£æŸ»ãƒ­ã‚°
model AuditLog {
  id         String    @id @default(cuid())
  employeeId String?
  employee   Employee? @relation(fields: [employeeId], references: [id], onDelete: SetNull)
  actor      String // system | user:{id}
  action     String // GRANT_CREATE / REQUEST_APPROVE / RECALC ...
  entity     String // GrantLot:xxx ç­‰
  payload    String // JSON
  createdAt  DateTime  @default(now())

  @@index([employeeId])
  @@index([action])
  @@map("audit_logs")
}

// æœ‰çµ¦ç®¡ç†è¨­å®šï¼ˆAppConfigï¼‰
model VacationAppConfig {
  id         String   @id @default(cuid())
  version    String   @unique // è¨­å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¸»ã‚­ãƒ¼ç›¸å½“ï¼‰
  configJson String // AppConfigã®JSONè¡¨ç¾
  isActive   Boolean  @default(false) // ç¾åœ¨ä½¿ç”¨ä¸­ã®è¨­å®š
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("vacation_app_configs")
}

model BulletinCategory {
  id        String     @id @default(cuid())
  name      String     @unique
  color     String     @default("secondary")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  bulletins Bulletin[]

  @@map("bulletin_categories")
}

model Bulletin {
  id          String            @id @default(cuid())
  title       String
  content     String
  pinned      Boolean           @default(false)
  publishedAt DateTime          @default(now())
  categoryId  String?
  category    BulletinCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([publishedAt])
  @@map("bulletins")
}

// ==========================
// ä¾¿åˆ©æ©Ÿèƒ½ï¼ˆConvenienceï¼‰
// ==========================

model ConvenienceCategory {
  id            String             @id @default(cuid())
  tenantId      String?
  name          String
  position      Int                @default(0)
  isArchived    Boolean            @default(false)
  isAdminOnly   Boolean            @default(false)
  deletedAt     DateTime?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  createdBy     String?
  updatedBy     String?
  createdByUser Employee?          @relation("ConvenienceCategoryCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser Employee?          @relation("ConvenienceCategoryUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  entries       ConvenienceEntry[]

  @@index([tenantId, position])
  @@map("convenience_categories")
}

model ConvenienceEntry {
  id            String                @id @default(cuid())
  categoryId    String
  category      ConvenienceCategory   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  title         String
  note          String?
  position      Int                   @default(0)
  isArchived    Boolean               @default(false)
  isAdminOnly   Boolean               @default(false)
  deletedAt     DateTime?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  createdBy     String?
  updatedBy     String?
  createdByUser Employee?             @relation("ConvenienceEntryCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser Employee?             @relation("ConvenienceEntryUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  urls          ConvenienceEntryUrl[]

  @@index([categoryId, position])
  @@map("convenience_entries")
}

model ConvenienceEntryUrl {
  id          String           @id @default(cuid())
  entryId     String
  entry       ConvenienceEntry @relation(fields: [entryId], references: [id], onDelete: Cascade)
  url         String
  description String?
  position    Int              @default(0)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([entryId, position])
  @@map("convenience_entry_urls")
}

// ==========================
// WorkClockï¼ˆæ¥­å‹™å§”è¨—æ™‚é–“ç®¡ç†ï¼‰ç”¨ãƒ¢ãƒ‡ãƒ«
// ==========================

model WorkClockWorker {
  id                      String                  @id @default(cuid())
  employeeId              String                  @unique
  employee                Employee                @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  name                    String
  password                String?
  companyName             String?
  qualifiedInvoiceNumber  String?
  chatworkId              String?
  email                   String
  phone                   String?
  address                 String?
  hourlyRate              Float
  // æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³åï¼ˆãƒ©ãƒ™ãƒ«ï¼‰
  wagePatternLabelA       String?                 @default("Aãƒ‘ã‚¿ãƒ¼ãƒ³")
  wagePatternLabelB       String?                 @default("Bãƒ‘ã‚¿ãƒ¼ãƒ³")
  wagePatternLabelC       String?                 @default("Cãƒ‘ã‚¿ãƒ¼ãƒ³")
  // è¿½åŠ ã®æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³é‡‘é¡ï¼ˆä»»æ„ï¼‰
  hourlyRateB             Float?
  hourlyRateC             Float?
  // å›æ•°ãƒ™ãƒ¼ã‚¹ã®æ”¯æ‰•ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆä»»æ„ï¼‰
  countPatternLabelA      String?                 @default("å›æ•°Aãƒ‘ã‚¿ãƒ¼ãƒ³")
  countPatternLabelB      String?                 @default("å›æ•°Bãƒ‘ã‚¿ãƒ¼ãƒ³")
  countPatternLabelC      String?                 @default("å›æ•°Cãƒ‘ã‚¿ãƒ¼ãƒ³")
  // å›æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³é‡‘é¡ï¼ˆä»»æ„ï¼‰
  countRateA              Float?
  countRateB              Float?
  countRateC              Float?
  // æœˆé¡å›ºå®šï¼ˆé‡‘é¡ã¨ON/OFFï¼‰
  monthlyFixedAmount      Int?
  monthlyFixedEnabled     Boolean                 @default(false)
  // æ¶ˆè²»ç¨è¨­å®š
  billingTaxEnabled       Boolean                 @default(false) // æ¶ˆè²»ç¨ã‚’è«‹æ±‚ã«åæ˜ ã™ã‚‹ã‹
  billingTaxRate          Float? // å€‹åˆ¥ã®æ¶ˆè²»ç¨ç‡ï¼ˆä¾‹: 10.0ï¼‰ã€‚æœªè¨­å®šæ™‚ã¯æ¨™æº–ç¨ç‡ã‚’ä½¿ç”¨
  taxType                 String                  @default("exclusive") // 'exclusive'ï¼ˆå¤–ç¨ï¼‰| 'inclusive'ï¼ˆå†…ç¨ï¼‰
  // æºæ³‰å¾´åè¨­å®šï¼ˆå…¨ä½“ï¼‰
  withholdingTaxEnabled   Boolean                 @default(false) // æºæ³‰å¾´åå¯¾è±¡ã‹ã©ã†ã‹ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ç”¨ï¼‰
  // æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã®æºæ³‰å¾´åON/OFF
  withholdingHourlyA      Boolean                 @default(false) // æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³Aæºæ³‰å¾´å
  withholdingHourlyB      Boolean                 @default(false) // æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³Bæºæ³‰å¾´å
  withholdingHourlyC      Boolean                 @default(false) // æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³Cæºæ³‰å¾´å
  // å›æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã®æºæ³‰å¾´åON/OFF
  withholdingCountA       Boolean                 @default(false) // å›æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³Aæºæ³‰å¾´å
  withholdingCountB       Boolean                 @default(false) // å›æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³Bæºæ³‰å¾´å
  withholdingCountC       Boolean                 @default(false) // å›æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³Cæºæ³‰å¾´å
  // æœˆé¡å›ºå®šã®æºæ³‰å¾´åON/OFF
  withholdingMonthlyFixed Boolean                 @default(false) // æœˆé¡å›ºå®šæºæ³‰å¾´å
  teams                   String? // JSONæ–‡å­—åˆ—ï¼ˆstring[]ï¼‰
  role                    String                  @default("worker") // 'worker' | 'admin'
  notes                   String?
  transferDestination     String? // æŒ¯è¾¼å…ˆ
  billingClientId         String? // è«‹æ±‚å…ˆIDï¼ˆä»»æ„ï¼‰
  billingClient           WorkClockBillingClient? @relation(fields: [billingClientId], references: [id], onDelete: SetNull)
  allowPastEntryEdit      Boolean                 @default(false) // éå»è¨˜éŒ²ã®ç·¨é›†è¨±å¯
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @updatedAt

  timeEntries   WorkClockTimeEntry[]
  rewards       WorkClockReward[]
  rewardPresets WorkClockRewardPreset[]

  // æ¥­å‹™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé–¢ä¿‚
  checklistPatternId   String?
  checklistPattern     WorkClockChecklistPattern?     @relation(fields: [checklistPatternId], references: [id], onDelete: SetNull)
  isChecklistEnabled   Boolean                        @default(false)
  checklistSubmissions WorkClockChecklistSubmission[]

  @@map("workclock_workers")
}

// è«‹æ±‚å…ˆãƒã‚¹ã‚¿ï¼ˆè¤‡æ•°ç¤¾ç™»éŒ²å¯èƒ½ï¼‰
model WorkClockBillingClient {
  id        String            @id @default(cuid())
  name      String            @unique // ä¼šç¤¾åï¼ˆä¾‹: æ ªå¼ä¼šç¤¾ABCï¼‰
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  workers   WorkClockWorker[]

  @@map("workclock_billing_clients")
}

model WorkClockTimeEntry {
  id           String          @id @default(cuid())
  workerId     String
  worker       WorkClockWorker @relation(fields: [workerId], references: [id], onDelete: Cascade)
  date         DateTime
  // æ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆä»»æ„ã€‚A/B/Cã®ã„ãšã‚Œã‹ï¼‰
  wagePattern  WagePattern?    @default(A)
  startTime    String
  endTime      String
  breakMinutes Int             @default(0)
  notes        String?
  // å›æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæ™‚çµ¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ä½µç”¨å¯èƒ½ï¼‰
  countPattern WagePattern?
  count        Int?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([workerId, date])
  @@map("workclock_time_entries")
}

model WorkClockReward {
  id          String          @id @default(cuid())
  workerId    String
  worker      WorkClockWorker @relation(fields: [workerId], references: [id], onDelete: Cascade)
  amount      Int
  description String
  date        DateTime
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([workerId, date])
  @@map("workclock_rewards")
}

model WorkClockRewardPreset {
  id          String          @id @default(cuid())
  workerId    String
  worker      WorkClockWorker @relation(fields: [workerId], references: [id], onDelete: Cascade)
  amount      Int
  description String
  isEnabled   Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([workerId])
  @@map("workclock_reward_presets")
}

model WorkClockTeam {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("workclock_teams")
}

// ==========================
// æ¥­å‹™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç”¨ãƒ¢ãƒ‡ãƒ«
// ==========================

// æ¥­å‹™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
model WorkClockChecklistPattern {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items   WorkClockChecklistItem[]
  workers WorkClockWorker[]

  @@map("workclock_checklist_patterns")
}

// æ¥­å‹™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®
model WorkClockChecklistItem {
  id          String                    @id @default(cuid())
  patternId   String
  pattern     WorkClockChecklistPattern @relation(fields: [patternId], references: [id], onDelete: Cascade)
  title       String
  reward      Float                     @default(0)
  isMandatory Boolean                   @default(false)
  isFreeText  Boolean                   @default(false) // è‡ªç”±è¨˜å…¥æ¬„ã‹ã©ã†ã‹
  category    String?
  position    Int                       @default(0)
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt

  @@index([patternId])
  @@map("workclock_checklist_items")
}

// æ¥­å‹™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæå‡ºï¼ˆå ±å‘Šï¼‰
model WorkClockChecklistSubmission {
  id            String          @id @default(cuid())
  workerId      String
  worker        WorkClockWorker @relation(fields: [workerId], references: [id], onDelete: Cascade)
  date          DateTime
  memo          String?
  hasPhoto      Boolean         @default(false)
  isSafetyAlert Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  items WorkClockChecklistSubmissionItem[]

  @@index([workerId, date])
  @@map("workclock_checklist_submissions")
}

// æå‡ºæ™‚ã®ãƒã‚§ãƒƒã‚¯é …ç›®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
model WorkClockChecklistSubmissionItem {
  id            String                       @id @default(cuid())
  submissionId  String
  submission    WorkClockChecklistSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  title         String
  reward        Float
  isMandatory   Boolean
  isChecked     Boolean
  isFreeText    Boolean                      @default(false) // è‡ªç”±è¨˜å…¥æ¬„ã‹ã©ã†ã‹
  freeTextValue String? // è‡ªç”±è¨˜å…¥æ¬„ã®å…¥åŠ›å€¤
  category      String?
  createdAt     DateTime                     @default(now())

  @@index([submissionId])
  @@map("workclock_checklist_submission_items")
}

// WorkClock AI Report Model
model WorkClockAIReport {
  id          String   @id @default(cuid())
  date        DateTime // ãƒ¬ãƒãƒ¼ãƒˆå¯¾è±¡æ—¥
  summary     String // AIç”Ÿæˆã‚µãƒãƒªãƒ¼
  promptId    String? // ä½¿ç”¨ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆID
  promptName  String? // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåï¼ˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰
  workerCount Int // å¯¾è±¡ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°
  alerts      Int // ã‚¢ãƒ©ãƒ¼ãƒˆä»¶æ•°
  totalReward Int // åˆè¨ˆã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–
  createdBy   String // ä½œæˆè€…ID
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([date])
  @@index([createdBy])
  @@index([createdAt])
  @@map("workclock_ai_reports")
}
